<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />









  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="FantinOcean">
<meta property="og:url" content="https://fantinyang.github.io/index.html">
<meta property="og:site_name" content="FantinOcean">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="FantinOcean">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://fantinyang.github.io/"/>





  <title>FantinOcean</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">FantinOcean</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Share</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fantinyang.github.io/2018/05/11/post1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fantin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FantinOcean">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/11/post1/" itemprop="url">To Visiters</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-11T19:52:05+08:00">
                2018-05-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> My very first post – To Visiters</p>
<h2 id="Who-Am-I"><a href="#Who-Am-I" class="headerlink" title="Who Am I"></a>Who Am I</h2><p> You can find me in…</p>
<ul>
<li><a href="https://www.facebook.com/profile.php?id=100010334744185" target="_blank" rel="noopener">Facebook</a> </li>
<li><a href="https://twitter.com/yangfantin" target="_blank" rel="noopener">Twitter</a></li>
<li><a href="https://www.instagram.com/yangfantin/" target="_blank" rel="noopener">Instagram</a></li>
<li><a href="https://weibo.com/y526147723/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo" target="_blank" rel="noopener">Weibo</a></li>
<li><a href="https://space.bilibili.com/7781422/#/" target="_blank" rel="noopener">Bilibili</a> </li>
<li><a href="yangfan.gm@gmail.com">Email</a>  </li>
</ul>
<p><strong>Facebook</strong>, <strong>Twitter</strong>, <strong>Insta</strong>, and <strong>Weibo</strong> are set up only as my social media, you can follow me if interested, but I won’t guarantee the quality.<br><strong>Bilibili</strong> is where I upload my Vlogs.<br>In the end, don’t hesitate to <strong>Email</strong> me.</p>
<h2 id="What-I-gonna-do"><a href="#What-I-gonna-do" class="headerlink" title="What I gonna do"></a>What I gonna do</h2><p>The reason why I set up this blog is that I want to share my working experience with freshmen in SDN, Wireless Security, OpenWrt and so on. Because when I first stepped foot in these areas, I couldn’t always find the useful information online. There full of repeated tutorials and blogs, and what important is that most of the tutorials are not suitable for freshmen in engineering, because they assume the readers have equipped enough basic knowledge.<br>So I decided to share the journey of me on this blog, where I will focus more on how to start up the engineering and how to get useful information.<br>Hope it will be helpful to you.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fantinyang.github.io/2018/06/16/post5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fantin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FantinOcean">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/16/post5/" itemprop="url">Open VSwitch in OpenWrt</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-16T17:31:58+08:00">
                2018-06-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在这一篇博客中，我将详细介绍如何在OpenWrt系统中搭建Open VSwitch，从而让AP适用于SDN系统。</p>
<p>AP有“瘦AP”（<strong>Fit AP</strong>）和“胖AP”（<strong>Fat AP</strong>）之分，Fat AP是与Fit AP相对来讲的，Fat AP将WLAN的物理层、用户数据加密认证、QoS、网络管理、漫游技术以及其他应用层的功能集于一身。Fat AP无线网络解决方案可由由Fat AP直接在有线网的基础上构成，设备结构复杂，且难于集中管理，比较常用于家庭无线接入，即所谓的“无线路由器”。Fit AP是一个只有加密、射频功能的AP，功能单一，不能独立工作。整个Fit AP无线网络解决方案由无线控制器和Fit AP在有线网的基础上构成。Fit AP上“零配置”，所有配置都集中到无线控制器上。这也促成了Fit AP解决方案更加便于集中管理，并由此具有三层漫游、基于用户下发权限等Fat AP不具备的功能。</p>
<p>本文的解决方案为Fat AP的SDN适配方案，解决思路为<strong>Fat AP + Openwrt + OVS</strong>。我将介绍三种在Openwrt下安装OVS的方法。</p>
<center><font size="10">Install OpenVSwitch in OpenWrt</font></center>

<hr>
<h3 id="方法一-编译一个带Open-VSwitch版本的OpenWrt固件"><a href="#方法一-编译一个带Open-VSwitch版本的OpenWrt固件" class="headerlink" title="方法一  编译一个带Open VSwitch版本的OpenWrt固件"></a>方法一  编译一个带Open VSwitch版本的OpenWrt固件</h3><p>这种方法是在Linux系统下直接编译一个带有Open VSwitch的固件，并将固件刷入AP中。</p>
<p>此方法操作步骤简单，但容易出错，编译过程常伴随各种未知错误。本人尝试过多次，编译过多种版本下的固件，失败多过成功。但这种方法还是推荐大家学习，方便日后进一步学习扩展。</p>
<ul>
<li><p>升级软件安装包，安装编译时需要的组件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install gccg++binutilspatchbzip2flexbison make autoconf gettext texinfo unzip sharutils subversion libncurses5-devncurses-term zlib1g-dev subversion git gawk asciidoc libz-dev</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取OpenWrt源码并添加OVS</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git://git.openwrt.org/openwrt.git <span class="comment">#获取Openwrt源码</span></span><br><span class="line"><span class="built_in">cd</span> openwrt</span><br><span class="line">./scripts/feeds update –a <span class="comment">#更新最新代码</span></span><br><span class="line">./scripts/feeds install –a <span class="comment">#安装最新组件</span></span><br><span class="line">svn up <span class="comment">#更新版本号</span></span><br><span class="line"><span class="comment">#添加openwrt代码连接</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'src-git openvswitch git://github.com/pichuang/openvwrt.git'</span> &gt;&gt; feeds.conf </span><br><span class="line"><span class="comment">#或者（建立代码连接）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'src-git openvswitch git://github.com/ttsubo/openvswitch.git'</span> &gt;&gt; feeds.conf </span><br><span class="line"></span><br><span class="line">./scripts/feeds update openvswitch </span><br><span class="line">./scripts/feeds install -a -p openvswitch</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译固件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>
<ul>
<li><p>1 选择CPU型号（根据AP硬件选择，可参见openwrt的wiki页面）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Target System—–Atheros AR71xx/AR7240/AR913x/AR934x</span><br></pre></td></tr></table></figure>
</li>
<li><p>2 选择路由型号（根据路由器型号选择）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TargetProfile—-xxxx</span><br></pre></td></tr></table></figure>
</li>
<li><p>3 添加 Luci 及相关组件（语言包+DNNS）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LuCI—&gt;Collections—–&lt;*&gt; luci</span><br><span class="line">LuCI—&gt;Translations—-&lt;*&gt; luci-i18n-chinese</span><br><span class="line">LuCI—&gt;Applications —&gt; &lt;*&gt;luci-app-ddns.</span><br></pre></td></tr></table></figure>
</li>
<li><p>4 添加UTF8编码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kernel modules —&gt; Native Language Support —&gt; &lt;*&gt; kmod-nls-utf8</span><br></pre></td></tr></table></figure>
</li>
<li><p>5  添加复位键支持</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Utilities —&gt; &lt;*&gt; restorefactory</span><br></pre></td></tr></table></figure>
</li>
<li><p>6 添加 openvswitch</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Network -&gt; openvswitch-switch, openvswitch-switch, openvswitch-ipsec (Optional)</span><br></pre></td></tr></table></figure>
</li>
<li><p>7 save</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make V=99</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>固件编译成功后将在 target 文件夹中找到 .bin 文件，然后将镜像文件刷进系统，就得到了一个有Open VSwitch的AP。</p>
<h3 id="方法二-通过opkg安装Open-Vswitch"><a href="#方法二-通过opkg安装Open-Vswitch" class="headerlink" title="方法二 通过opkg安装Open Vswitch"></a>方法二 通过opkg安装Open Vswitch</h3><p>这种方法是利用Openwrt系统本身的<strong>opkg</strong>(Open PacKaGe management)管理器直接从互联网下载OVS的安装文件和相关依赖。</p>
<p>此方法有个前提是必须保证AP本身可以上网。</p>
<p>####AP连入互联网</p>
<p>Openwrt系统的官方固件中的WAN是默认DPCH上网的，最简单的上网方式是连接到上级网络的路由器：<strong>用网线连接此AP的WAN口和可上网的路由器的LAN口</strong>。这样Openwrt可以直接通过DPCH方式上网，不需要任何配置。</p>
<p>如果没有一个正常上网的路由器，AP联网的方式和其他商用路由器类似。首先将AP的WAN口连接到墙上的网口，打开luci界面：<strong>192.168.1.1</strong>，选择接口(interfaces)，编辑WAN，然后按照运营商的上网方式设置相对的上网协议，输入账号密码等。</p>
<h4 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h4><ul>
<li><p>打开<strong>SecureCRT</strong>用SSH协议连接到Openwrt（ip地址：192.168.1.1，具体方式可参见上一篇博客）。</p>
</li>
<li><p>更新安装包并安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">opkg update -a</span><br><span class="line">opkg install kmod-openvswitch</span><br><span class="line">opkg install openvswitch</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>我在使用这个方法安装时，一直出现无法连接到官方下载网站的问题。无法完成更新，也无法安装。</p>
<h3 id="方法三-使用ipk安装包安装"><a href="#方法三-使用ipk安装包安装" class="headerlink" title="方法三  使用ipk安装包安装"></a>方法三  使用ipk安装包安装</h3><p>第三种方法是我自己发现的方法，优点是简单而且不容易出错，但缺点就是太麻烦。如果走投无路了，也可以尝试一下这个方法。</p>
<p>此方法就是在Openwrt的软件库上下载相对应的安装包，放入Openwrt的 <strong>/tmp/</strong>文件夹内，利用<strong>opkg install</strong>命令安装。</p>
<ul>
<li><p>在openwrt的<a href="https://archive.openwrt.org/" target="_blank" rel="noopener">archive</a>网站找到对应的Openwrt固件版本</p>
<p><a href="https://archive.openwrt.org/attitude_adjustment" target="_blank" rel="noopener">attitude_adjustment</a>            v12.09</p>
<p><a href="https://archive.openwrt.org/backfire" target="_blank" rel="noopener">backfire</a>                        v10.03 / v10.03.1</p>
<p><a href="https://archive.openwrt.org/barrier_breaker" target="_blank" rel="noopener">barrier_breaker</a>                v14.07</p>
<p><a href="https://archive.openwrt.org/chaos_calmer" target="_blank" rel="noopener">chaos_calmer</a>                v15.05 / v15.05.1</p>
<p><a href="https://archive.openwrt.org/releases" target="_blank" rel="noopener">releases</a>                        v17.01.0 - v17.01.4</p>
<p><a href="https://archive.openwrt.org/snapshots" target="_blank" rel="noopener">snapshots</a>                    trunk</p>
</li>
<li><p>进入分类和版本内，选择相应文件系统，普遍是<strong>ar71xx</strong>。</p>
</li>
<li><p>选择 <strong>genetic/</strong>文件夹</p>
</li>
<li><p>选择<strong>Supplementary Files</strong>中的<strong>packages</strong>。</p>
</li>
<li><p><strong>packages</strong>文件夹中有六个文件夹，所有的ipk文件都在这六个文件夹中。</p>
<p>​    base/                    Openwrt系统工具（大部分工具安装包可在其中找到）</p>
<p>​    luci/                    luci相关</p>
<p>​    management/            管理包（不常用）</p>
<p>​    packages/                工具和其他依赖文件</p>
<p>​    routing/                    不常用</p>
<p>​    telephony/                不常用</p>
<p>大部分的基础工具都可以在 <strong>base/</strong> 文件夹中找到，所需的依赖文件可在 <strong>packages/</strong> 中找到。</p>
</li>
<li><p>在<strong>packages/</strong>文件夹中，用ctrl+F搜索 openvswitch ，下载以下ipk文件：</p>
<p>​    openvswitch_xx.xx.xx (xx是版本号)</p>
<p>​    openvswitch-benchmark_xx.xx.xx</p>
<p>​    kmod_openvswitch_xx.xx.xx</p>
</li>
<li><p>打开<strong>SecureCRT</strong>软件和<strong>WinSCP</strong>软件，连接到AP。</p>
</li>
<li><p>用<strong>WinSCP</strong>将ipk文件导入到 Openwrt 系统的 <strong>/tmp/</strong> 文件夹下。</p>
</li>
<li><p>在<strong>SecureCRT</strong>中输入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp/</span><br><span class="line">opkg install openvswitch_xx.xx.xx.ipk <span class="comment">#正确文件名</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装一定会失败，并提示<strong>缺少以下依赖</strong>，此时，在archive文件夹中根据错误提示逐个寻找依赖的ipk文件包，用同样的方式进行安装。</p>
</li>
<li><p>安装完所有缺省再次安装openvswitch的ipk。</p>
</li>
<li><p>安装ovs时，如果出现内核版本不对的错误提示，但又确实是安装了同一个CPU版本下的ovs包，可以尝试强制安装，如果安装之后可以使用ovs，就没有问题。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opkg --force-depends install openvswitch_xx.xx.xx.ipk</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这个方法确实非常麻烦，但是成功率很高，同时也适用于安装其他类型的工具包，所以比较推荐。</p>
<hr>
<p>以上是我总结的三种在openwrt上安装openvswitch的方法，下一篇我讲继续介绍ovs的相关配置和使用。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fantinyang.github.io/2018/05/29/post4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fantin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FantinOcean">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/29/post4/" itemprop="url">Start With OpenWrt /3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-29T17:42:28+08:00">
                2018-05-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> Start with OpenWrt /3</p>
<h2 id="终极刷机——TTL法"><a href="#终极刷机——TTL法" class="headerlink" title="终极刷机——TTL法"></a>终极刷机——TTL法</h2><hr>
<p>TTL刷机就是指用TTL线（串口线）让路由器与电脑的BOOT进行串口通信，然后通过网口利用TFTP把固件传输过来。</p>
<p>所以这种方法同样适合在路由器死机变砖了之后救活它。</p>
<p>引用一个<a href="https://blog.csdn.net/xcoderone/article/details/48030771" target="_blank" rel="noopener">滑冰犀鸟</a>的原理解释：</p>
<blockquote>
<h3 id="原理说明"><a href="#原理说明" class="headerlink" title="原理说明"></a>原理说明</h3><ul>
<li>TTL线就是串口线（USB转串口）。</li>
<li>系统固件不是通过TTL线传输到路由器中。</li>
<li>TTL线的作用是让PC端和BOOT进行串口通信。</li>
<li>PC端通过串口线使用BOOT的控制台。</li>
<li>系统固件实际是通过网口（TFTP协议）传输到路由器中。</li>
</ul>
</blockquote>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ul>
<li><p>TTL刷机需要进行一些焊接工作，提前准备好<strong>电烙铁，排针，杜邦线</strong>等电工工具。</p>
</li>
<li><p><strong>TTL转USB线</strong>，可以在淘宝买到，但是一定要买对型号，具体可参考wiki或询问淘宝客服。</p>
</li>
<li><p>网线</p>
</li>
<li><p>Windows上安装SecureCRT、Putty、Tftpd(注意选择32位/64位)。</p>
</li>
</ul>
<h3 id="硬件准备"><a href="#硬件准备" class="headerlink" title="硬件准备"></a>硬件准备</h3><p>首先，在OpenWrt的wiki页面找到相应型号路由器的电路板图片。以TP-LINK 841n为例，它的<a href="https://wiki.openwrt.org/toh/tp-link/tl-wr841nd" target="_blank" rel="noopener">wiki</a>页面下有一个<strong>Serial port settings:</strong>栏，在其中你可以找到电路板上GND RX TX在哪（一般都不会使用到VCC，但具体还是要根据路由器型号判断）。</p>
<p><img src="https://wiki.openwrt.org/_media/media/tplink/tl-wr841/tl-wr841n-v7.2_serial-pinout.jpg?cache=" alt="hardware"></p>
<p>然后，将GND口、TX和RX焊上排针，再用杜邦线连接出来。</p>
<p><strong>TTL转USB线</strong>比较推荐如图这样的，无须再焊接，把从排针印出来的杜邦线接上就可以了。需要注意的是，购买转串口线的时候一定要注意型号，在wiki看好型号再去找，买的时候也要多和卖家沟通，否则会出现扫码率怎么都对不上等乱七八糟的问题。</p>
<p><img src="https://www.icshop.com.tw/images/product_images/original_images/22215_0.gif" alt="杜邦线"></p>
<p>接着，将电路板引出来的TX接到串口线的RX，RX接到TX，GND接GND，电路方面的准备工作理论上就完成了。</p>
<h3 id="正式刷机"><a href="#正式刷机" class="headerlink" title="正式刷机"></a>正式刷机</h3><ul>
<li>设置电脑ip设置到与路由器相同网段，如：192.168.1.169</li>
<li>打开<strong>SecureCRT</strong>，按照如下设置并连接。</li>
</ul>
<p>​    protol: <strong>Serial</strong></p>
<p>​    port: <strong>COMx</strong> （在电脑的<strong>设备管理器</strong>中查看端口号）</p>
<p>​    Baud rate: <strong>115200</strong>（通常是这个速率，但具体值根据型号不同有所不同）</p>
<p>​    Data bits: <strong>8</strong></p>
<p>​    Parity: <strong>None</strong></p>
<p>​    Stop bits: <strong>1</strong></p>
<p>​    Flow Control: <strong>均不钩选</strong></p>
<p>​    </p>
<ul>
<li><p>将电脑的无线网卡禁用，如果电脑有多张有线网卡也将其他几张禁用，关闭防火墙。</p>
</li>
<li><p>把官方固件（openwrt-ar71xx-generic-tl-wr841nd-v7-squashfs-factory.bin</p>
<p>）与<strong>Tftpd32</strong>放在同一个文件夹中（官方固件的获取方式在上两篇文章中有介绍），打开tftpd。</p>
</li>
<li><p>将USB串口连接到电脑，为路由器通电，<strong>WAN</strong>口用网线与电脑网口相连，在SecureCRT中可以看到开机信息，则证明串口连接成功。</p>
<p>如果出现乱码，应该是Baud rate设置有误；如果没有反应，但路由器灯正常亮起，则可能是电路出了问题。</p>
</li>
<li><p>将路由器断电，重新通电，在SecureCRT上查看打印信息，出现</p>
<blockquote>
<p>Autobooting in 1s…</p>
</blockquote>
<p>马上在键盘上按下tpl（也有一些路由器需要按Ctrl+c 或者其他，具体可以参照特定路由器的刷机教程）</p>
</li>
<li><p>成功进入路由器系统的boot界面。</p>
</li>
<li><p>在窗口输入：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenv ipaddr 192.168.1.1</span><br><span class="line">setenv serverip 192.168.1.169</span><br></pre></td></tr></table></figure>
<p>​    ipaddr 是路由器的ip地址</p>
<p>​    serverip是电脑的ip地址</p>
</li>
<li><p>将固件拷到路由器内存中，0x80000000是flash上一段空白位置，可以暂时存储文件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ar7240&gt; tftpboot 0x80000000 openwrt-ar71xx-generic-tl-wr841n-v8-squashfs-factory.bin</span><br><span class="line">Using eth0 device</span><br><span class="line">TFTP from server 192.168.1.100; our IP address is 192.168.1.111</span><br><span class="line">Filename <span class="string">'openwrt-ar71xx-generic-tl-wr841n-v8-squashfs-factory.bin'</span>.</span><br><span class="line">Load address: 0x80000000</span><br><span class="line">Loading: checksum bad</span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">         <span class="comment">#################################################################</span></span><br><span class="line">         <span class="comment">#################################################################</span></span><br><span class="line">         <span class="comment">#################################################################</span></span><br><span class="line">         <span class="comment">#################################################################</span></span><br><span class="line">         <span class="comment">#################################################################</span></span><br><span class="line">         <span class="comment">#################################################################</span></span><br><span class="line">         <span class="comment">#################################################################</span></span><br><span class="line">         <span class="comment">#################################################################</span></span><br><span class="line">         <span class="comment">#################################################################</span></span><br><span class="line">         <span class="comment">#################################################################</span></span><br><span class="line">         <span class="comment">######################################################</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">Bytes transferred = 3932160 (3c0000 hex)</span><br></pre></td></tr></table></figure>
</li>
<li><p>将flash原来的固件文件擦除</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ar7240&gt; erase 0x9f020000 +0x3c0000</span><br></pre></td></tr></table></figure>
<p>0x9f020000为内核的启动地址，在<strong>开机的引导信息</strong>中可以看到，见840N的U-boot行 </p>
<blockquote>
<p>Booting image at 9f020000 …</p>
</blockquote>
<p> 不同的路由器启动地址也有所不同，具体情况可以在uboot行中看到。 </p>
<p>0x3c0000为固件大小，这个输错了路由器会变砖，上一步返回信息的最后一句会给出。</p>
</li>
<li><p>擦除完成后，将openwrt固件复制到固件启动地址中，bootm启动。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ar7240&gt; cp.b 0x80000000 0x9f020000 0x3c0000</span><br><span class="line">ar7240&gt; bootm 0x9f020000</span><br></pre></td></tr></table></figure>
</li>
<li><p>之后，系统就开始重新启动了，将计算机网线接入LAN口，完成刷机啦。</p>
</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>特别说明，这里的刷机过程是以TP-LINK TL-WR841N为例的，其他型号可能在细节上需要稍作改动，但具体都可以参考<a href="http://wiki.openwrt.org/toh/start#tp-link" target="_blank" rel="noopener">Openwrt wiki</a>，当然，这句话也是经常出现在我的教程里，就是去wiki页面参考。虽然wiki是英文版面，有时候大家看起来会有点吃力而遗漏很多细节，但是其中真的包罗万象，几乎能解决你所有遇到的问题。所以在wiki中好好探索吧。</p>
<p>虽然想写一个适用于新手的教程，但是写下来才发现，其实每个人遇到的问题都是不一样的，而我也只能主要强调我踩过的坑。所以也许也不是那么适合所有人，这一点真的非常遗憾。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fantinyang.github.io/2018/05/13/post3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fantin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FantinOcean">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/13/post3/" itemprop="url">Start With OpenWrt /2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-13T10:19:21+08:00">
                2018-05-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> Start With OpenWrt /2</p>
<h2 id="刷机进阶——TFTP法"><a href="#刷机进阶——TFTP法" class="headerlink" title="刷机进阶——TFTP法"></a>刷机进阶——TFTP法</h2><p>这两种方式在Openwrt的wiki页面应该都有很详细的指导教程，我的经验是，如果你找到了一个自认为靠谱的教程，也记得先看看wiki上的介绍，有个大致的概念和对错判断。如果两者有出入，基本还是以wiki为准的。</p>
<hr>
<h3 id="TFTP"><a href="#TFTP" class="headerlink" title="TFTP"></a>TFTP</h3><p>用TFTP方式刷机的原理其实和网页版本差不多，有一些版本的路由器甚至要挂载TFTP服务器才能完成固件更新。我的理解来说，TFTP的好处就在于有时候可能可以跨过网页版运营商对非官方固件的屏蔽，比较粗暴得导入固件。</p>
<p>用TFTP的方式，个人推荐是在<strong>Linux</strong>系统下进行，命令行输入、启动tftp服务器什么的会更方便。</p>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><ul>
<li>1.安装并启动<strong>TFTP服务器(TFTP Server)</strong>，注意将<strong>TFTP固件</strong>放在home(host)文件夹下，因为用tftp传输时，固件前不能添加路径。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install tftpd-hpa tftp</span><br><span class="line">sudo cp ~/uboot/arch/arm/boot/uboot.img /var/lib/tftpboot</span><br></pre></td></tr></table></figure>
<ul>
<li>2.将固件重命名为简单形式，如 <strong>a1.bin</strong>。（这一步可有可无，仅仅为了方便接下来的命令行输入）</li>
<li>3.TFTP传输过程中必须保证网络链接在路由器开启电源时就建立，为保重这一步成功，可以先关闭网络。(根据你linux系统的版本从以下选择合适的命令行)</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/networking stop</span><br><span class="line">/etc/init.d/network stop</span><br><span class="line">/etc/init.d/NetworkManager stop</span><br><span class="line">service networking stop</span><br><span class="line">service network stop</span><br><span class="line">service NetworkManager stop</span><br></pre></td></tr></table></figure>
<ul>
<li>4.配置与引导程序相匹配的静态IP地址。（一般为192.168.1.1，可以从路由器wiki页面中找到相关信息）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0 ipv4.x.y.z netmask 255.255.255.0</span><br></pre></td></tr></table></figure>
<ul>
<li>5.为TFTP预置arp请求条目</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arp -s ipv4.x.y.1 20:aa:bb:cc:dd:00</span><br><span class="line"><span class="meta">#</span><span class="bash">ipv4.x.y.1 是路由器ip地址</span></span><br><span class="line"><span class="meta">#</span><span class="bash">20:aa:bb:cc:dd:00 是路由器背面的MAC地址</span></span><br></pre></td></tr></table></figure>
<h4 id="基本步骤"><a href="#基本步骤" class="headerlink" title="基本步骤"></a>基本步骤</h4><p>做完以上准备工作可以正式开始了。用<strong>TFTP客户端(TFTP Client)</strong>将固件上传路由器的基本方法如下：</p>
<ul>
<li>1.断开路由器电源</li>
<li>2.用网线将电脑与路由器<strong>LAN</strong>口相连</li>
<li><p>3.在电脑上启动<strong>TFTP客户端</strong></p>
</li>
<li><p>4.TFTP到路由器的<strong>ip地址</strong>(可在wiki页面查询)</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tftp IPv4.x.y.z</span><br><span class="line"><span class="meta">#</span><span class="bash">IPv4.x.y.z 为路由器的ip地址</span></span><br></pre></td></tr></table></figure>
<ul>
<li>5.设置TFTP传输模式为<strong>octet/binary</strong>(二进制传输)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">tftp&gt;</span><span class="bash"> binary </span></span><br><span class="line"><span class="meta">tftp&gt;</span><span class="bash"> rexmt 1 <span class="comment">#传输间隔为1秒</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>6.设置TFTP重传直至成功</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">tftp&gt;</span><span class="bash"> timeout 60</span></span><br><span class="line"><span class="meta">tftp&gt;</span><span class="bash"> trace</span></span><br><span class="line"><span class="meta">tftp&gt;</span><span class="bash"> Packet tracing on.</span></span><br></pre></td></tr></table></figure>
<ul>
<li>7.用put命令设置传输的固件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">tftp&gt;</span><span class="bash"> put openwrt-xxx-x.x-xxx.bin</span></span><br></pre></td></tr></table></figure>
<ul>
<li>8.TFTP客户端开始工作的<strong>同时</strong>打开路由器电源</li>
<li>9.路由器大概需要<strong>十多秒</strong>才会成功启动，再次之前TFTP客户端持续发送请求。检测到路由器后，TFTP客户端将开始发送固件。</li>
<li>10.等待传输完成，路由器重启。</li>
</ul>
<h3 id="TFTP方式的其他命令行形式实现"><a href="#TFTP方式的其他命令行形式实现" class="headerlink" title="TFTP方式的其他命令行形式实现"></a>TFTP方式的其他命令行形式实现</h3><h4 id="aTFTP"><a href="#aTFTP" class="headerlink" title="aTFTP"></a>aTFTP</h4><ul>
<li>一条命令行</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">atftp --trace --option "timeout 1" --option "mode octet" --put --local-file openwrt-xxx-x.x-xxx.bin IPv4.x.y.z</span><br></pre></td></tr></table></figure>
<p>​    <em> <strong>按下回车的同时接通路由器电源</strong> </em></p>
<ul>
<li>分布命令行</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">atftp</span><br><span class="line">connect IPv4.x.y.z</span><br><span class="line">mode octet</span><br><span class="line">trace</span><br><span class="line">timeout 1</span><br><span class="line">put openwrt-xxx-x.x-xxx.bin</span><br></pre></td></tr></table></figure>
<h4 id="Netkit’s-TFTP"><a href="#Netkit’s-TFTP" class="headerlink" title="Netkit’s TFTP"></a>Netkit’s TFTP</h4><ul>
<li>一条命令行</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -e "binary\nrexmt 1\ntimeout 60\ntrace\nput openwrt-xxx-x.x-xxx.bin\n" | tftp IPv4.x.y.z</span><br></pre></td></tr></table></figure>
<ul>
<li>分布命令行</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tftp IPv4.x.y.z</span><br><span class="line">tftp&gt; binary</span><br><span class="line">tftp&gt; rexmt 1</span><br><span class="line">tftp&gt; timeout 60</span><br><span class="line">tftp&gt; trace</span><br><span class="line">tftp&gt; Packet tracing on.</span><br><span class="line">tftp&gt; put openwrt-xxx-x.x-xxx.bin</span><br></pre></td></tr></table></figure>
<h4 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -T openwrt-xxx-x.x-xxx.bin tftp://IPv4.x.y.z</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Tips总结"><a href="#Tips总结" class="headerlink" title="Tips总结"></a>Tips总结</h3><p>用TFTP的方式有几个需要特别注意的点：</p>
<ul>
<li>一定要将固件放在home文件夹下，因为tftp put 的时候只添加文件名，不能前置文件路径。</li>
<li>开始tftp传输的<strong>同时</strong>接通电源</li>
<li>主机的ip地址要与路由器的ip地址在一个子网下，所以不要忘记提前把网络模式从DHCP改成Static。</li>
</ul>
<p>希望这篇能够帮助到你，用tftp方式刷机总体来说实现难度不大，但是一定要细心，不要遗漏任何步骤。遇到问题可以详见OpenWrt的Wiki页面，基本都有详细的教程。同时也欢迎通过Email联系我。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://fantinyang.github.io/2018/05/12/post2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fantin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FantinOcean">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/12/post2/" itemprop="url">Start With OpenWrt</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-12T12:53:08+08:00">
                2018-05-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> Start With OpenWrt</p>
<h2 id="从挑选路由器到刷机"><a href="#从挑选路由器到刷机" class="headerlink" title="从挑选路由器到刷机"></a>从挑选路由器到刷机</h2><p>不管你的用途是什么，只要涉及自定义路由器，<a href="https://openwrt.org/" target="_blank" rel="noopener">Openwrt</a>是最常用也最好用的开源系统。把一款商用路由器刷成Openwrt路由器，其实就是更改路由器的固件——将路由器默认的固件（.bin）文件替换。那么如何将市面上买的商用路由器刷成Openwrt系统呢？第一步要做的，是先选择一款路由器。</p>
<hr>
<h3 id="选择路由器"><a href="#选择路由器" class="headerlink" title="选择路由器"></a>选择路由器</h3><p>首先，选择路由器基本可以遵循以下步骤：</p>
<ul>
<li>选择一个路由器<strong>品牌(Brand)</strong>（D-Link，TP-Link等），在网上查询现有售卖的<strong>型号(Model)</strong>。</li>
<li>在Openwrt的<a href="https://wiki.openwrt.org/toh/start" target="_blank" rel="noopener">wiki</a>页面上选择品牌和型号，与市面上还能买到的路由器对应查看，选择一款能够买到的。</li>
<li>进入对应路由器wiki页面，查看Openwrt官方固件出的<strong>版本号(Version)</strong>。</li>
<li>向卖家确认路由器版本号。</li>
</ul>
<p>到这里都没有碰壁，只能说你非常幸运。因为通过正规渠道有售的路由器在Openwrt上能找到的就已经不多，其次即使找到了相同的型号，市面上的路由器版本也往往太新，而Openwrt没有release新版本的固件。</p>
<p>这里需要特别注意的是，旧版本一般不能适配新版本，虽然他们的型号一样，但是不同版本之间的硬件设置不同。而且，同一个版本的海内外产品也有区别。</p>
<p>还要说明的是，OpenWrt是国外的平台，而路由器厂商针对中国市场和海外市场对同一款路由器有不同版本的配置。一般而言，海外版本的路由器更适合搭载Openwrt系统，因为他们往往拥有更大的Flash内存。国内的新路由器一般只配置4M的Flash内存（有的甚至只有2M），基本只够勉强塞入固件系统（3.8M），更别提承载其他配置。</p>
<p>所以我的经验是，通过正规渠道一般已经没有办法购买到合适的路由器了，就算真的购买到了，后续可能也需要对路由器的Flash和RAM进行扩容。嫌麻烦的人其实可以直接上淘宝买个改装好的路由器，有工程追求的人请参见以下几篇硬改教程：</p>
<ul>
<li><a href="https://blog.csdn.net/aggresss/article/details/52753098" target="_blank" rel="noopener">aggresss的专栏</a></li>
<li><a href="https://my.oschina.net/osbin/blog/282141" target="_blank" rel="noopener">TP-LINK 845N V1硬改</a></li>
<li><a href="https://blog.csdn.net/flyingcys/article/details/54671532" target="_blank" rel="noopener">TP-LINK_841N_V8路由器</a> （好文！）</li>
</ul>
<hr>
<h3 id="路由器刷机"><a href="#路由器刷机" class="headerlink" title="路由器刷机"></a>路由器刷机</h3><p>现在，你有了一个可以刷Openwrt官方固件的路由器，但是我们默认路由器内置的固件还是运营商提供的。所以这一步讲的是如何将固件刷成Openwrt，难度从低到高有三种：</p>
<ul>
<li>网页法</li>
<li>TFTP法</li>
<li>TTL法</li>
</ul>
<p>在开始刷机之前，要先对路由器的结构有个基本的认识。路由器上的网线接口一般有1个WAN口，和多个LAN口，一般有不同的颜色和标识。</p>
<p><img src="/blog/source/_posts/post2/Screen Shot 2018-05-12 at 12.41.04 PM.png" alt="路由器网口标识"></p>
<p>除此之外，还有一个电源接口和一个小小的reset孔（一般而言reset孔在里面，要用牙签或者针头戳进去）。</p>
<h4 id="网页法"><a href="#网页法" class="headerlink" title="网页法"></a>网页法</h4><p>首先在路由器的Openwrt Wiki 页面里找到官方的release版本，下载到本地。注意区分Install Image和Update Image，这里我们选择Install Image，文件后缀是<strong>squashfs-factory.bin</strong>。</p>
<p><img src="/blog/source/_posts/post2/20140417175607_4955.png" alt="下载镜像和更新镜像"></p>
<p>然后，将路由器断电，将LAN1口用网线与电脑连接，然后摁住reset按钮，同时接通电源。</p>
<p>观察路由器的亮灯情况，一般要维持10s左右，亮灯状态维持稳定时，松开reset按钮。因为不同的路由器亮灯情况不同，如果不放心可以直接搜索 路由器型号+刷机 ，找到教程看具体的状态。</p>
<p>从路由器背面查看ip地址，一般为：192.168.1.1，从网页输入ip地址登录。（账号密码信息也会在路由器背面贴出，一般默认是 admin ，如果没有可以上路由器官网查看。）</p>
<p>进入页面后，选择软件升级，然后添加刚刚下载的 <strong>.bin</strong> 文件，点击更新即可。<strong>注意过程中保持电源通电，等待路由器重启成功。</strong> </p>
<p>通过网页的方式非常简单，但是也经常失败，如果不成功可以尝试：</p>
<ul>
<li>关闭电脑防火墙</li>
<li>查看版本号是否对应</li>
</ul>
<p>路由器运营商也可能会针对网页刷机做一些屏蔽，所以网页刷机往往成功率不高。如果失败了，可以继续尝试用TFTP方式甚至TTL方式刷机。具体方法，请参加以下两篇。</p>
<h4 id="TFTP法"><a href="#TFTP法" class="headerlink" title="TFTP法"></a><a href="https://fantinyang.github.io/2018/05/13/post3/">TFTP法</a></h4><h4 id="TTL法"><a href="#TTL法" class="headerlink" title="TTL法"></a><a href="">TTL法</a></h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Fantin" />
          <p class="site-author-name" itemprop="name">Fantin</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/FantinYang" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="yangfan.gm@gmail.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-e-mail"></i>
                  
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/yangfantin" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://weibo.com/y526147723/profile?rightmod=1&wvr=6&mod=personinfo" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fantin</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
